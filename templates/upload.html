{% extends "base.html" %}

{% block title %}–ê–Ω–∞–ª–∏–∑ –≤—ã–≥—Ä—É–∑–∫–∏ –°–≠–ú–î{% endblock %}

{% block content %}

<h2 class="mb-4">–ê–Ω–∞–ª–∏–∑ –≤—ã–≥—Ä—É–∑–∫–∏ –°–≠–ú–î</h2>

{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}

{% if filename %}
<p><strong>–§–∞–π–ª:</strong> {{ filename }}</p>
{% endif %}

<div id="errors" class="section">
    <h4>‚ùå –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫</h4>
    {% if table_errors %}{{ table_errors|safe }}{% else %}<p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>{% endif %}
</div>

<div id="doctors" class="section">
    <h4>üë®‚Äç‚öïÔ∏è –í—Ä–∞—á–∏, –≤—ã–ø–æ–ª–Ω–∏–≤—à–∏–µ > 500 –°–≠–ú–î</h4>
    {% if table_doctors %}{{ table_doctors|safe }}{% else %}<p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>{% endif %}
</div>

<div id="types" class="section">
    <h4>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –°–≠–ú–î</h4>
    {% if table_types %}{{ table_types|safe }}{% else %}<p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>{% endif %}
</div>

<div id="cert_errors" class="section">
    <h4>üîê –û—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h4>
    {% if table_cert_errors %}{{ table_cert_errors|safe }}{% else %}<p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>{% endif %}
</div>

<div id="pie" class="section">
    <h4>üü£ –ö—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –†–≠–ú–î</h4>
    <canvas id="pieChart" width="400" height="300"></canvas>
    <script>
        const pieCtx = document.getElementById('pieChart');
        new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: {{ pie_labels|default([])|tojson }},
                datasets: [{
                    data: {{ pie_values|default([])|tojson }},
                    backgroundColor: ['#4e79a7', '#f28e2c', '#e15759', '#76b7b2']
                }]
            }
        });
    </script>
</div>

<div id="bar" class="section">
    <h4>üìâ –°—Ç–æ–ª–±—á–∞—Ç–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ –æ—à–∏–±–æ–∫ –ø–µ—Ä–µ–¥–∞—á–∏</h4>
    <canvas id="barChart" width="400" height="300"></canvas>
    <script>
        const barCtx = document.getElementById('barChart');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: {{ bar_labels|default([])|tojson }},
                datasets: [{
                    label: "–û—à–∏–±–∫–∏",
                    data: {{ bar_values|default([])|tojson }},
                    backgroundColor: '#f28e2c'
                }]
            },
            options: {
                indexAxis: 'y'
            }
        });
    </script>
</div>

<div id="raw" class="section">
    <h4>üìã –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h4>

    {% if table_raw %}
        <button class="btn btn-outline-primary mb-3" onclick="toggleRawTable()">
            üìÇ –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
        </button>
        <div id="rawTableBlock" style="display: none;">
            <div class="table-responsive mb-4">
                {{ table_raw | safe }}
            </div>
        </div>
    {% else %}
        <p><em>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</em></p>
    {% endif %}

    {% if table_errors_dict %}
        <button class="btn btn-outline-secondary mb-3" onclick="toggleReference()">
            üîç –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –æ—à–∏–±–æ–∫
        </button>
        <div id="errorReferenceBlock" style="display: none;">
            <div class="card card-body">
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd;">
                    {{ table_errors_dict | safe }}
                </div>
            </div>
        </div>
    {% endif %}
</div>

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />

<script>
function toggleReference() {
    const block = document.getElementById("errorReferenceBlock");
    block.style.display = block.style.display === "none" ? "block" : "none";
}
function toggleRawTable() {
    const block = document.getElementById("rawTableBlock");
    block.style.display = block.style.display === "none" ? "block" : "none";
}
    document.addEventListener("DOMContentLoaded", function () {
        const mainTable = document.getElementById("mainTable");
        if (mainTable) {
            $('#mainTable').DataTable({
                pageLength: 50,
                lengthMenu: [10, 25, 50, 100, 1000],
                scrollY: "300px",
                scrollCollapse: true
            });
        }
    });
</script>
{% endblock %}

{% endblock %}